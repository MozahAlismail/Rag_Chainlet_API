build:
  - python -m pip install --upgrade pip
  - pip install -r requirements.txt

start:
  - uvicorn api:app --host 0.0.0.0 --port $PORT

env:
  PYTHON_VERSION: "3.9"
  
variables:
  PORT: 8000
  HUGGINGFACE_HUB_CACHE: "/tmp/huggingface"
  TRANSFORMERS_CACHE: "/tmp/transformers"
  TORCH_HOME: "/tmp/torch"
  
nixpacks:
  phases:
    setup:
      nixPkgs:
        - python39
        - gcc
        - g++
        - cmake
        - pkg-config
    build:
      cmds:
        - python -m pip install --upgrade pip
        - pip install -r requirements.txt
        - python -c "import torch; print(f'PyTorch version: {torch.__version__}')"
        - python -c "import transformers; print(f'Transformers version: {transformers.__version__}')"
    start:
      cmd: uvicorn api:app --host 0.0.0.0 --port $PORT

healthcheck:
  path: /
  port: $PORT
  
memory: 4096MB
cpu: 2000m

volumes:
  - /tmp/huggingface
  - /tmp/transformers
  - /tmp/torch
